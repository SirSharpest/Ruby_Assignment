#+TITLE: Assignment 1
#+AUTHOR: Nathan Hughes ([[mailto:nah31@aber.ac.uk][nah26@aber.ac.uk]])
#+OPTIONS: toc:nil
#+LaTeX_CLASS: article
#+LaTeX_CLASS_OPTIONS: [a4paper]
#+LaTeX_HEADER: \usepackage[margin=0.8in]{geometry}
#+LaTeX_HEADER: \usepackage{amssymb,amsmath}
#+LaTeX_HEADER: \usepackage{fancyhdr} %For headers and footers
#+LaTeX_HEADER: \pagestyle{fancy} %For headers and footers
#+LaTeX_HEADER: \usepackage{lastpage} %For getting page x of y
#+LaTeX_HEADER: \usepackage{float} %Allows the figures to be positioned and formatted nicely
#+LaTeX_HEADER: \restylefloat{figure} %and this command
#+LaTeX_HEADER: \usepackage{hyperref}
#+LaTeX_HEADER: \hypersetup{urlcolor=blue}
#+LaTeX_HEADER: \usepackage{minted}
#+LATEX_HEADER: \setminted{frame=single,framesep=10pt}
#+LaTeX_HEADER: \chead{}
#+LaTeX_HEADER: \rhead{\today}
#+LaTeX_HEADER: \cfoot{}
#+LaTeX_HEADER: \rfoot{\thepage\ of \pageref{LastPage}}
#+LaTeX_HEADER: \usepackage[parfill]{parskip}
#+LaTeX_HEADER:\usepackage{subfig}
#+latex_header: \hypersetup{colorlinks=true,linkcolor=black}
#+LATEX_HEADER_EXTRA:  \usepackage{framed}

\vspace{2cm}

#+BEGIN_CENTER
#+ATTR_LATEX: :width 4cm 
[[./ruby.png]]
#+END_CENTER

#+LATEX: \clearpage
#+LATEX: \tableofcontents
#+LATEX: \clearpage


* Introduction 

* Steps taken 

** Creating a new rails site
#+CAPTION: Editing File X
#+BEGIN_SRC BASH
rails new csa
#+END_SRC 

** Generating Scaffolds for Users and Posts
#+CAPTION: Editing File X
#+BEGIN_SRC BASH
rails g scaffold Post title
rails g scaffold Users surname forename phone grad_year:integer jobs:boolean email
#+END_SRC 

** Adding constraints to Users
#+CAPTION: Editing File X
#+BEGIN_SRC RUBY
class CreateUsers < ActiveRecord::Migration[5.1]
  def change
    create_table :users do |t|
      t.string :surname, null:false
      t.string :forename, null:false
      t.string :phone
      t.integer :grad_year, null:false
      t.boolean :jobs, default: false
      t.string :email, null:false

      t.timestamps
    end

    add_index:users,:surname
    add_index:users,:email
    
  end
end
#+END_SRC

** Change index routing to Posts
#+CAPTION: Editing File X
#+BEGIN_SRC RUBY
Rails.application.routes.draw do
  resources :users
  resources :posts

  root 'posts#index'
  
end
#+END_SRC

** Update these changes and migrate to the Database
#+CAPTION: Editing File X
#+BEGIN_SRC BASH
rails db:migrate
#+END_SRC 

** Adding Users and Body to Posts

*** Creating a migrate file for adding body
#+CAPTION: Editing File X
#+BEGIN_SRC BASH
rails g migration add_body_to_posts body:text
#+END_SRC 

*** Creating a migrate file for linking tables
#+CAPTION: Editing File X
#+BEGIN_SRC BASH
rails g migration add_user_to_posts user:references
#+END_SRC 

*** Update Post model
#+CAPTION: Editing File X
#+BEGIN_SRC RUBY
class Post < ApplicationRecord
  validates_presence_of :title

  belongs_to :user,optional: true
end
#+END_SRC
*** Update User model
#+CAPTION: Editing File X
#+BEGIN_SRC RUBY
class User < ApplicationRecord
  has_many :posts,
           dependent: :destroy
end
#+END_SRC


*** Updating views for Posts form
To do this we edit the view component of posts, which was generated by the initial scaffold commands
#+CAPTION: Editing File X
#+BEGIN_SRC bash
  <div class="field">
    <%= form.label :email %>
    <%= if post.user
      text_field_tag 'email',post.user.email
    else
      text_field_tag 'email'
    end %>
  </div>
  
  <div class="field">
    <%= form.label :body %><br>
    <%= form.text_area :body %>
  </div>
#+END_SRC 

*** Updating view for Posts listing
#+CAPTION: Editing File X
#+BEGIN_SRC bash
<p>
  <strong>Title:</strong>
  <%= @post.title %>
</p>

<p>
  <strong>Email:</strong>
  <% if @post.user %>
    <%= link_to "#{@post.user.email}", @post.user %>
  <% else %>
    Anonymous
  <% end %>
</p>

<p>
  <%= @post.body %>
</p>
#+END_SRC



** TODO Paginations

** TODO Tabbing

* TODO MVC Model 
  
** TODO UML Diagram

*** Database
#+NAME: fig:uml
#+begin_src plantuml :results file :file posts-users.png
class Posts{
  +title :string
  +body :string
}

class Users{
  +surname :string
  +forename :string
  +phone :string
  +email :string
  +grad_year :integer
  +jobs :boolean
}

Posts "*" -- "0..1" Users

#+end_src

#+BEGIN_CENTER
#+CAPTION: Posts and Users UML
#+ATTR_LATEX: :width 4cm
#+RESULTS: fig:uml
#+END_CENTER

*** TODO What is the Model-2 Variant
** TODO Models
** TODO Views
** TODO Controls


* Database

** TODO Database location

** TODO Migration Files
#+BEGIN_SRC BASH
rails db:migrate
#+END_SRC 
